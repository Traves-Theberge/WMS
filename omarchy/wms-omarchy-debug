#!/bin/bash

# Simple WMS Launcher for Omarchy
# Debug version with logging

LOG_FILE="/tmp/wms-omarchy-debug.log"
exec > >(tee -a "$LOG_FILE") 2>&1

echo "$(date): WMS Omarchy launcher starting..."
echo "Working directory: $(pwd)"
echo "Script location: $(dirname "$0")"

# Change to the WMS directory
WMS_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
echo "WMS Directory: $WMS_DIR"

cd "$WMS_DIR" || {
    echo "ERROR: Cannot change to WMS directory: $WMS_DIR"
    exit 1
}

echo "Current directory after cd: $(pwd)"
echo "Contents: $(ls -la)"

# Check if the executable exists
if [[ ! -f "./wms" ]]; then
    echo "ERROR: wms executable not found. Building..."
    if ! go build -o wms ./cmd/wms; then
        echo "ERROR: Failed to build WMS"
        exit 1
    fi
fi

echo "Starting WMS application..."
exec "./wms" "$@"